<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EHDEN HMB - How-to-Run Study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">EHDEN HMB</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-technical-info" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Technical Info</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-technical-info">    
        <li>
    <a class="dropdown-item" href="./techSpecs.html" rel="" target="">
 <span class="dropdown-text">Requirements</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./news.html" rel="" target="">
 <span class="dropdown-text">News</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-study-info" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Study Info</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-study-info">    
        <li>
    <a class="dropdown-item" href="./sap.html" rel="" target="">
 <span class="dropdown-text">Analysis Plan</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./howToRun.html" rel="" target="">
 <span class="dropdown-text">How-To-Run</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./contribution.html" rel="" target="">
 <span class="dropdown-text">Contibution Guidelines</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/OdyOSG/ehden_hmb" rel="" target="">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/OdyOSG/ehden_hmb/issues/new?assignees=mdlavallee92&amp;labels=bug&amp;projects=&amp;template=bug_report.md&amp;title=" rel="" target="">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p><img src="images/ehden.png" class="img-fluid"></p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup-study" id="toc-setup-study" class="nav-link active" data-scroll-target="#setup-study"><span class="header-section-number">1</span> Setup Study</a>
  <ul class="collapse">
  <li><a href="#download-zip" id="toc-download-zip" class="nav-link" data-scroll-target="#download-zip"><span class="header-section-number">1.1</span> Download Zip</a></li>
  <li><a href="#setup-r-environment" id="toc-setup-r-environment" class="nav-link" data-scroll-target="#setup-r-environment"><span class="header-section-number">1.2</span> Setup R Environment</a>
  <ul class="collapse">
  <li><a href="#using-renv" id="toc-using-renv" class="nav-link" data-scroll-target="#using-renv"><span class="header-section-number">1.2.1</span> Using <code>renv</code></a></li>
  <li><a href="#troubleshooting-renv" id="toc-troubleshooting-renv" class="nav-link" data-scroll-target="#troubleshooting-renv"><span class="header-section-number">1.2.2</span> Troubleshooting <code>renv</code></a></li>
  <li><a href="#conflicts" id="toc-conflicts" class="nav-link" data-scroll-target="#conflicts"><span class="header-section-number">1.2.3</span> Conflicts</a></li>
  </ul></li>
  <li><a href="#load-execution-credentials" id="toc-load-execution-credentials" class="nav-link" data-scroll-target="#load-execution-credentials"><span class="header-section-number">1.3</span> Load Execution Credentials</a>
  <ul class="collapse">
  <li><a href="#required-credentials" id="toc-required-credentials" class="nav-link" data-scroll-target="#required-credentials"><span class="header-section-number">1.3.1</span> Required Credentials</a></li>
  <li><a href="#loading-credentials" id="toc-loading-credentials" class="nav-link" data-scroll-target="#loading-credentials"><span class="header-section-number">1.3.2</span> Loading Credentials</a></li>
  <li><a href="#multiple-databases-optional" id="toc-multiple-databases-optional" class="nav-link" data-scroll-target="#multiple-databases-optional"><span class="header-section-number">1.3.3</span> Multiple Databases (Optional)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#run-study" id="toc-run-study" class="nav-link" data-scroll-target="#run-study"><span class="header-section-number">2</span> Run Study</a>
  <ul class="collapse">
  <li><a href="#execution-script" id="toc-execution-script" class="nav-link" data-scroll-target="#execution-script"><span class="header-section-number">2.1</span> Execution Script</a></li>
  <li><a href="#study-tasks" id="toc-study-tasks" class="nav-link" data-scroll-target="#study-tasks"><span class="header-section-number">2.2</span> Study Tasks</a></li>
  <li><a href="#review-cohort-diagnostics" id="toc-review-cohort-diagnostics" class="nav-link" data-scroll-target="#review-cohort-diagnostics"><span class="header-section-number">2.3</span> Review Cohort Diagnostics</a>
  <ul class="collapse">
  <li><a href="#troubleshooting-1" id="toc-troubleshooting-1" class="nav-link" data-scroll-target="#troubleshooting-1"><span class="header-section-number">2.3.1</span> Troubleshooting</a></li>
  </ul></li>
  <li><a href="#results-folder" id="toc-results-folder" class="nav-link" data-scroll-target="#results-folder"><span class="header-section-number">2.4</span> Results Folder</a></li>
  <li><a href="#review-results" id="toc-review-results" class="nav-link" data-scroll-target="#review-results"><span class="header-section-number">2.5</span> Review Results</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">How-to-Run Study</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="setup-study" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup Study</h1>
<section id="download-zip" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="download-zip"><span class="header-section-number">1.1</span> Download Zip</h2>
<p>To avoid using git to leverage this study, the easiest way to access the study code is via a zip file. Instructions for downloading the zip file are below:</p>
<ol type="1">
<li>Navigate to github <a href="https://github.com/OdyOSG/ehden_hmb">repo url</a>.</li>
<li>Select the green code button revealing a dropdown menu.</li>
<li>Select <em>Download Zip</em>.</li>
<li>Unzip the folder on your local computer that is easily accessible within R Studio.</li>
<li>Open the unzipped folder and select <code>ehden_hmb.Rproj</code>.</li>
</ol>
<!---Add clone process--------->
</section>
<section id="setup-r-environment" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="setup-r-environment"><span class="header-section-number">1.2</span> Setup R Environment</h2>
<section id="using-renv" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="using-renv"><span class="header-section-number">1.2.1</span> Using <code>renv</code></h3>
<p>This study uses <a href="https://rstudio.github.io/renv/articles/renv.html"><code>renv</code></a> to reproduce the R environment to execute this study. The study code maintains an <code>renv.lock</code> file in the main branch of the repository. To activate the R dependencies through <code>renv</code> use the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="troubleshooting-renv" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="troubleshooting-renv"><span class="header-section-number">1.2.2</span> Troubleshooting <code>renv</code></h3>
<p>Sometimes there are errors in the package installation via <code>renv</code>. If you encounter an error try removing the problematic package from the <code>renv.lock</code> file and restore again. To remove a package from the lock file find the header of the package and delete all corresponding lines. Once you are able to get the remaining packages to install, manually install the problem package using one of the strategies below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Installing an R package from CRAN ------------</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Installing latest version of R package on CRAN</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Installing archived version of R package on CRAN</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>packageurl <span class="ot">&lt;-</span> <span class="st">"http://cran.r-project.org/src/contrib/Archive/ggplot2/ggplot2_0.9.1.tar.gz"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(packageurl, <span class="at">repos=</span><span class="cn">NULL</span>, <span class="at">type=</span><span class="st">"source"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Installing an R package from github -----------------</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Installing current version of R package from github</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"remotes"</span>) <span class="co"># note you may also work devtools</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ohdsi/FeatureExtraction"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Installing develop version of R package from github</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ohdsi/Ulysses"</span>, <span class="at">ref =</span> <span class="st">"develop"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Installing old version of R package from github</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ohdsi/CohortGenerator"</span>, <span class="at">ref =</span> <span class="st">"v0.7.0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Any additional issues with the <code>renv</code> lock file please file an <a href="https://github.com/OdyOSG/ehden_hmb/issues/new?assignees=mdlavallee92&amp;labels=bug&amp;projects=&amp;template=bug_report.md&amp;title=">issue</a> in the study repository</p>
</section>
<section id="conflicts" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="conflicts"><span class="header-section-number">1.2.3</span> Conflicts</h3>
<p>Some organizational IT setups pose conflicts with <code>renv</code>. One example is if your organization uses the Broadsea Docker. If you are aware that your OHDSI environment will conflict with <code>renv</code>, deactivate it by running <code>renv::deactivate()</code> in the active ehden .RProj. Also delete the renv folder in your project directory. Review the list of R packages required to run the study in the <strong>Technical Requirements</strong> tab of the study hub and manually install.</p>
<p>It is <strong>highly recommended</strong> you stick with the <code>renv</code> snapshot as this is the easiest way to reproduce the study execution environment. Please only deactivate the lock file if it is a last resort.</p>
</section>
</section>
<section id="load-execution-credentials" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="load-execution-credentials"><span class="header-section-number">1.3</span> Load Execution Credentials</h2>
<p>This study uses <code>keyring</code> and <code>config</code> to mask and query database credentials needed for execution. The study will help load these credentials using the file <code>extras/KeyringSetup.R</code>.</p>
<section id="required-credentials" class="level3" data-number="1.3.1">
<h3 data-number="1.3.1" class="anchored" data-anchor-id="required-credentials"><span class="header-section-number">1.3.1</span> Required Credentials</h3>
<p>Data nodes executing this study require the following credentials:</p>
<ol type="1">
<li><strong>dbms</strong> - the name of the dbms you are using (redshift, postgresql, snowflake, etc)</li>
<li><strong>user</strong> - the username credential used to connect to the OMOP database</li>
<li><strong>password</strong> - the password credential used to connect to the OMOP database</li>
<li><strong>connectionString</strong> - a composed string that establishes the connection to the OMOP database. An example of a connection string would be <em>jdbc:dbms://host-url.com:port/database_name</em>.</li>
<li><strong>cdmDatabaseSchema</strong> - the database and schema used to access the cdm. Note that this credential may be separated by a dot to indicate the database and schema, which tends to be the case in sql server. Example: <em>our_cdm.cdm</em>.</li>
<li><strong>vocabDatabaseSchema</strong> - the database and schema used to access the vocabulary tables. Note this is typically the same as the cdmDatabaseSchema.</li>
<li><strong>workDatabaseSchema</strong> - a section of the database where the user has read/write access. This schema is where we write the cohortTable used to enumerate the cohort definitions.</li>
</ol>
<p>It is recommended that you write these credentials down in a private txt file to make it easier to load into the credential manager for the study.</p>
</section>
<section id="loading-credentials" class="level3" data-number="1.3.2">
<h3 data-number="1.3.2" class="anchored" data-anchor-id="loading-credentials"><span class="header-section-number">1.3.2</span> Loading Credentials</h3>
<ol type="1">
<li>Open the file in the study names <code>extras/KeyringSetup.R</code>.</li>
<li>On L15:16 place a name for your config block and the database. The configBlock name can be an abbreviation, for example:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>configBlock <span class="ot">&lt;-</span> <span class="st">"synpuf"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>database <span class="ot">&lt;-</span> <span class="st">"synpuf_110k"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>One at a time run each line in the script and follow any prompts
<ul>
<li>L27 asks you to build a new config.yml file which can be done as so <code>Ulysses::makeConfig(block = configBlock, database = database)</code>. Running this function will open a new file. Make sure any keyring variable is labelled as <strong>ehden_hmb</strong>.</li>
<li>L32 will setup a new <code>keyring</code> for the study. The name of the keyring is <strong>ehden_hmb</strong> and the password for the keyring is <strong>ohdsi</strong>. If R prompts you to place a keyring password it will be <strong>ohdsi</strong> unless changed by the user.</li>
<li>L36 will setup all the credentials for the study. A prompt will appear asking to input credentials, using your txt file input your credentials into the prompt. Review the credentials once you are done</li>
</ul></li>
</ol>
<section id="troubleshooting" class="level4" data-number="1.3.2.1">
<h4 data-number="1.3.2.1" class="anchored" data-anchor-id="troubleshooting"><span class="header-section-number">1.3.2.1</span> Troubleshooting</h4>
<p>If you have a problem with the keyring, please post an <a href="https://github.com/OdyOSG/ehden_hmb/issues/new?assignees=mdlavallee92&amp;labels=bug&amp;projects=&amp;template=bug_report.md&amp;title=">issue</a> in the study repository. Otherwise you can avoid the keyring api by hard-coding your credentials to the <code>config.yml</code> file as shown in the example:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">db</span><span class="kw">:</span><span class="co"> # replace with an acronym for your database no underscore</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">databaseName</span><span class="kw">:</span><span class="at"> db_ehr</span><span class="co"> # replace with the name of your database</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">dbms</span><span class="kw">:</span><span class="at"> &lt;your_dbms&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">user</span><span class="kw">:</span><span class="at">  &lt;your_user&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">password</span><span class="kw">:</span><span class="at">  &lt;your_pass&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">connectionString</span><span class="kw">:</span><span class="at"> &lt;your_connectionString&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cdmDatabaseSchema</span><span class="kw">:</span><span class="at">  &lt;your_ cdmDatabaseSchema&gt;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">vocabDatabaseSchema</span><span class="kw">:</span><span class="at">  &lt;your_ vocabDatabaseSchema&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">workDatabaseSchema</span><span class="kw">:</span><span class="at"> &lt;your_ workDatabaseSchema&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">cohortTable</span><span class="kw">:</span><span class="at"> ehden_hmb_&lt;databaseName&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="multiple-databases-optional" class="level3" data-number="1.3.3">
<h3 data-number="1.3.3" class="anchored" data-anchor-id="multiple-databases-optional"><span class="header-section-number">1.3.3</span> Multiple Databases (Optional)</h3>
<p>Some study participants will be running this study on multiple databases. To add additional credentials rerun the <code>extras/KeyringSetup.R</code> file replacing the configBlock and database with a second database you need to use. on L28 you can add the following function to add a new config block to the <code>config.yml</code> file.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Ulysses<span class="sc">::</span><span class="fu">addConfig</span>(<span class="at">block =</span> <span class="st">"[next_block]"</span>, <span class="at">database =</span> <span class="st">"[next_database]"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="run-study" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Run Study</h1>
<section id="execution-script" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="execution-script"><span class="header-section-number">2.1</span> Execution Script</h2>
<p>Running all tasks sequentially can be done using the <code>executeStudy.R</code> file. Replace L17 with the configBlock of choice and run the script.</p>
</section>
<section id="study-tasks" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="study-tasks"><span class="header-section-number">2.2</span> Study Tasks</h2>
<p>Once your study is setup you are ready to run the EHDEN HMB study. The EHDEN HMB study contains six analytical tasks:</p>
<ol type="1">
<li><strong>Build Cohorts</strong> - initialize a cohort table and generate cohort counts from the circe json in cohortsToCreate</li>
<li><strong>Cohort Diagnostics</strong> - review of the hmb cohort definition</li>
<li><strong>Incidence Analysis</strong> - calculation of the incidence of hmb in a population of females between ages 11 to 55</li>
<li><strong>Baseline Characteristics</strong> - generation of prevalence of demographics and comorbidities at baseline (-365d prior to index)</li>
<li><strong>Treatment Patterns</strong> - calculation of drug prevalence post-index, sequences and time to treatment discontinuation</li>
<li><strong>Procedure Analysis</strong> - calculation of post-index prevalence of procedures and time to initial treatment</li>
</ol>
<p>Each task will output to the <code>results</code> folder. <strong>Note</strong> that the first task <em>buildCohorts</em> is required to run any additional analytical task (base dependency). If a cohort definition json has changed it requires rerunning the <em>buildCohorts</em> task.</p>
</section>
<section id="review-cohort-diagnostics" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="review-cohort-diagnostics"><span class="header-section-number">2.3</span> Review Cohort Diagnostics</h2>
<p>If you would like to review the results of the Cohort Diagnostics prior to sending you can do so by the instructions below:</p>
<ol type="1">
<li>Open the file <code>extras/ExploreDiagnostics.R</code></li>
<li>Run the R file line by line
<ul>
<li>Replace L20 with the name of your database</li>
<li>L28 will create a new folder in the directory called <code>scratchDiagnostics</code> where it will save the sqlite object</li>
<li>L36 prepares the diagnostics results per database</li>
<li>L41 launches the shiny app</li>
</ul></li>
<li>Ignore any warning messages about reserved keywords and navigation containers</li>
</ol>
<section id="troubleshooting-1" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="troubleshooting-1"><span class="header-section-number">2.3.1</span> Troubleshooting</h3>
<p><strong>Multiple Databases</strong></p>
<p>Some data partners may be running this study on multiple databases. If that is the case then you to identify a folder that contains all the zip files produced from the <code>CohortDiagnostics</code> routine. To check if this file was produced, go into the <code>cohortDiagnostics</code> folder of each database and identify the <code>.zip</code> file amongst the csv. It should be labelled something like <code>Results_database.zip</code>. You can collect all of these zip files in a single folder and make the <code>dataFolder</code> target as the folder with the multiple zip files per database.</p>
<p><strong>Shiny App</strong></p>
<p>The shiny app rendered from <code>CohortDiagnostics</code> relies on the OHDSI package <code>OhdsiShinyModules</code>. This package is installed within the <code>renv</code> snapshot loaded with the package. If you are having trouble launching the app from within the <code>ehden_hmb.RProj</code>, exit the R project and try launching the app outside the study session. If you are outside the <code>ehden_hmb.RProj</code> remember you have to provide full file paths because you are no longer zoomed in on the study directory.</p>
</section>
</section>
<section id="results-folder" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="results-folder"><span class="header-section-number">2.4</span> Results Folder</h2>
<p>Following successful execution of the study, each database will have its own sub-folder within results. There will be a further 14 subfolders containing results from the execution underneath the database. Within each of these folders there will be a combination of <code>csv</code>, <code>rds</code> and <code>parquet</code> (only for treatmentHistory) that contain the results. You may review these files individually if you wish. Instructions on how to share the results are maintained in the contribution tab of the website.</p>
</section>
<section id="review-results" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="review-results"><span class="header-section-number">2.5</span> Review Results</h2>
<p>In version 0.2 of the study code, we have added code to launch a shiny app to locally review results prior to distributing them to the study host. In order to run the shiny app the user needs to prep the data for the app. Navigate to <code>extras/PreviewResults.R</code> and run the first step. This will take all databases run in the results section and build a data folder for the shiny app. This data folder is ignored to prevent accidental commits back to github. Next launch the shiny app.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">Copyright 2023, Odysseus Data Services</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>